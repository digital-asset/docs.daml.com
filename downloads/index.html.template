<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Daml Enterprise Downloads</title>
    <link rel="stylesheet" href="downloads.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css">
  </head>
  <body>
  <div id="navbar">
    <div class="left">
      <img src="https://docs.daml.com/_static/images/Daml_Logo_Blue.svg">
      <span>Downloads</span>
    </div>
    <div class=right>
      <a href="https://docs.daml.com">Go Back to Docs</a>
    </div>
  </div>
  <div id="banner">
    <h1>Downloads</h1>
    <span>The files you need to get started with Daml</span>
  </div>
  <div id="content">
    <div class="dropdown">
      <div class="label">Release Version:</div>
      <div class="select" tabindex=0>
        <div class="version">Version <%= default_version %></div>
        <img src="down.svg" alt="closed" />
      </div>
      <div class="menu-ctn">
        <div class="menu">
          <div class="options">
            <% for (v of versions) { %>
              <div class="option">
                <div class="version">Version <%= v.version %></div>
                <% if (v.version == default_version) { %>
                  <img src="check.svg" />
                <% } %>
              </div>
            <% }%>
          </div>
        </div>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th scope="col">Component</th>
          <th scope="col">File Downloads</th>
          <th scope="col">Container Image</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <script>
    var versions = <%- JSON.stringify(versions) %>;
    var select = document.querySelector("#content .dropdown .select");
    var menu = document.querySelector("#content .dropdown .menu");
    var img = document.querySelector("#content .dropdown .select > img");
    var dropdown_opened = false;
    function close_dropdown() {
      select.classList.remove("opened");
      menu.classList.remove("opened");
      img.src = "down.svg";
      dropdown_opened = false;
    }
    function open_dropdown() {
      select.classList.add("opened");
      menu.classList.add("opened");
      img.src = "up.svg";
      dropdown_opened = true;
    }
    select.addEventListener("click", (event) => {
      if (dropdown_opened) {
        close_dropdown();
      } else {
        open_dropdown();
      }
    });
    select.addEventListener("blur", (event) => {
      close_dropdown();
    });
    function data_to_elements(d) {
      if (typeof d == "string") {
        return document.createTextNode(d);
      }
      var e;
      if (typeof d[0] == "string") {
        e = document.createElement(d[0]);
      } else {
        e = document.createElement(d[0]["tag"]);
        for ([k, v] of Object.entries(d[0])) {
          if (k != "tag") {
            e.setAttribute(k, v);
          }
        }
      }
      for (var child of d.splice(1).map(data_to_elements)) {
        e.appendChild(child);
      }
      return e;
    }
    var table_parent = document.querySelector("#content table tbody");
    function display_table(version) {
      var new_version = versions.filter((v) => v.version == version).at(0);
      var new_table = new_version.components
                                 .map((c) => ["tr",
                                              ["td", ["div", c.name]],
                                              ["td", ["div"].concat(c.files.map((f) => [{"tag": "a", "href": f.url}, f.name]))],
                                              ["td", ["div", c.docker]]])
                                 .map(data_to_elements);
      table_parent.replaceChildren(...new_table);
    }
    display_table("<%= default_version %>");
  </script>
  </body>
</html>
