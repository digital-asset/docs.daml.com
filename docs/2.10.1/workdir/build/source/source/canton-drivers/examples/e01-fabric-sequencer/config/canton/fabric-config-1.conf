# Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
# SPDX-License-Identifier: Apache-2.0

#
# Using this configuration file, you can configure the Canton Fabric Sequencer connector for multiple HL Fabric local and external networks.
#
# Instructions:
# 1. This configuration file assumes that you understand Hyperledger Fabric structure and concepts.
# 2. If you are going to connect this system to an existing HL Fabric network, please download the necessary certificates:
#    2.1. Organization(s) TLS certificate
#    2.2. Fabric Client key file
#    2.3. Fabric Client Certificate
# 3. For using the connector in your laptop, we recommend using the pre-existing configuration.
#
# Global attributes description:
# user: information on the Fabric client user.
#    msp-id: Id of organization in the Membership Service Provider.
#    organization-name: the name of the organization the user belongs to. The organization must have been defined under organizations
#    client-user: Fabric client user.
#    private-key-file: Fabric client key file.
#    signed-cert-file: Fabric client certificate file.
# organizations: encapsulates the data about the components that compose each organization of the network.
#   name: name of the organization.
#   tls-cert-file: TLS certificate of the organization. It is used to communicate with peers and orderers through the client SDK.
#   peers: list of peers of the organization.
#     name: name of the peer
#     url: core peer address
#   orderers: list of orderers of the organization.
#     name: name of orderer
#     url: orderer address
# channel: configuration of the channel where the Canton-on-Fabric chaincode is going to run. A channel is a communication link between multiple organizations. It has a common ledger available to all participants through their peers.
#   name: name of the channel
#   chaincode: config about chaincode usage
#     name: chaincode name. this defaults to "sequencer"
#     start-block-height: height of the block where the chaincode has been deployed. Defaults to 0. This is only used the first time the sequencer application is started to tell where to start reading from.
#     query-wait-time-millis: time that the Fabric SDK will wait for a query in the chaincode.
#     invoke-wait-time-millis: time that the Fabric SDK will wait for invoking a chaincode function.
# validation: configuration for when Canton should log warnings that the configuration of Canton or the Fabric network may be faulty.
#   blocks-behind-head: when should Canton warn that it is currently processing blocks that are behind the latest block in the blockchain

_org1-user-path="/etc/ledger-data/crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com"
canton.sequencers.fabricSequencer1 {
    public-api {
        port = 3000
        address = "0.0.0.0"
    }
    admin-api {
        port = 4000
        address = "0.0.0.0"
    }
    storage {
        type = postgres
        config {
            dataSourceClass = "org.postgresql.ds.PGSimpleDataSource"
            properties = {
                serverName = "pg.database1"
                portNumber = "5432"
                databaseName = "db"
                user = "user"
                password = "pass"
            }
            numThreads = 20
        }
    }
    sequencer {
        type = "fabric"
        config {
            user = {
                msp-id=Org1MSP
                msp=${_org1-user-path}"/msp"
                organization-name="org1.example.com"
                client-user=User1
                private-key-file=${_org1-user-path}"/tls/client.key"
                signed-cert-file=${_org1-user-path}"/tls/client.crt"
            }
            organizations=[
                {
                    name="org1.example.com"
                    tls-cert-file=${_org1-user-path}"/tls/ca.crt"
                    orderers=[]
                    peers=[
                        {
                            name=peer0
                            url="grpcs://peer0.org1.example.com:7051"
                        }
                    ]
                },
                {
                    name="example.com"
                    tls-cert-file="/etc/ledger-data/crypto-config/ordererOrganizations/example.com/users/Admin@example.com/tls/ca.crt"
                    orderers=[
                        {
                            name=orderer
                            url="grpcs://orderer.example.com:7050"
                        }
                    ]
                    peers=[]
                }
            ]
            channel {
                name=mychannel
                chaincode {
                    query-wait-time-millis=30000
                    invoke-wait-time-millis=60000
                }
            }
        }
    }
}
